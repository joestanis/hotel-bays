
YUI.add('attribute-core',function(Y){Y.State=function(){this.data={};};Y.State.prototype={add:function(name,key,val){var d=this.data;d[name]=d[name]||{};d[name][key]=val;},addAll:function(name,o){var key;for(key in o){if(o.hasOwnProperty(key)){this.add(name,key,o[key]);}}},remove:function(name,key){var d=this.data;if(d[name]){delete d[name][key];}},removeAll:function(name,o){var d=this.data;if(!o){if(d[name]){delete d[name];}}else{Y.each(o,function(v,k){if(Y.Lang.isString(k)){this.remove(name,k);}else{this.remove(name,v);}},this);}},get:function(name,key){var d=this.data;return(d[name])?d[name][key]:undefined;},getAll:function(name,reference){var d=this.data,o;if(!reference){Y.each(d[name],function(v,k){o=o||{};o[k]=v;});}else{o=d[name];}
return o;}};var O=Y.Object,Lang=Y.Lang,DOT=".",GETTER="getter",SETTER="setter",READ_ONLY="readOnly",WRITE_ONCE="writeOnce",INIT_ONLY="initOnly",VALIDATOR="validator",VALUE="value",VALUE_FN="valueFn",LAZY_ADD="lazyAdd",ADDED="added",BYPASS_PROXY="_bypassProxy",INITIALIZING="initializing",INIT_VALUE="initValue",LAZY="lazy",IS_LAZY_ADD="isLazyAdd",INVALID_VALUE;function AttributeCore(attrs,values,lazy){this._initAttrHost(attrs,values,lazy);}
AttributeCore.INVALID_VALUE={};INVALID_VALUE=AttributeCore.INVALID_VALUE;AttributeCore._ATTR_CFG=[SETTER,GETTER,VALIDATOR,VALUE,VALUE_FN,WRITE_ONCE,READ_ONLY,LAZY_ADD,BYPASS_PROXY];AttributeCore.prototype={_initAttrHost:function(attrs,values,lazy){this._state=new Y.State();this._initAttrs(attrs,values,lazy);},addAttr:function(name,config,lazy){Y.log('Adding attribute: '+name,'info','attribute');var host=this,state=host._state,value,hasValue;config=config||{};lazy=(LAZY_ADD in config)?config[LAZY_ADD]:lazy;if(lazy&&!host.attrAdded(name)){state.addAll(name,{lazy:config,added:true});}else{if(host.attrAdded(name)&&!state.get(name,IS_LAZY_ADD)){Y.log('Attribute: '+name+' already exists. Cannot add it again without removing it first','warn','attribute');}
if(!host.attrAdded(name)||state.get(name,IS_LAZY_ADD)){hasValue=(VALUE in config);if(config.readOnly&&!hasValue){Y.log('readOnly attribute: '+name+', added without an initial value. Value will be set on initial call to set','warn','attribute');}
if(hasValue){value=config.value;delete config.value;}
config.added=true;config.initializing=true;state.addAll(name,config);if(hasValue){host.set(name,value);}
state.remove(name,INITIALIZING);}}
return host;},attrAdded:function(name){return!!this._state.get(name,ADDED);},get:function(name){return this._getAttr(name);},_isLazyAttr:function(name){return this._state.get(name,LAZY);},_addLazyAttr:function(name,cfg){var state=this._state,lazyCfg=state.get(name,LAZY);state.add(name,IS_LAZY_ADD,true);state.remove(name,LAZY);this.addAttr(name,lazyCfg);},set:function(name,val){return this._setAttr(name,val);},_set:function(name,val){return this._setAttr(name,val,null,true);},_setAttr:function(name,val,opts,force){var allowSet=true,state=this._state,stateProxy=this._stateProxy,cfg,initialSet,strPath,path,currVal,writeOnce,initializing;if(name.indexOf(DOT)!==-1){strPath=name;path=name.split(DOT);name=path.shift();}
if(this._isLazyAttr(name)){this._addLazyAttr(name);}
cfg=state.getAll(name,true)||{};initialSet=(!(VALUE in cfg));if(stateProxy&&name in stateProxy&&!cfg._bypassProxy){initialSet=false;}
writeOnce=cfg.writeOnce;initializing=cfg.initializing;if(!initialSet&&!force){if(writeOnce){Y.log('Set attribute:'+name+', aborted; Attribute is writeOnce','warn','attribute');allowSet=false;}
if(cfg.readOnly){Y.log('Set attribute:'+name+', aborted; Attribute is readOnly','warn','attribute');allowSet=false;}}
if(!initializing&&!force&&writeOnce===INIT_ONLY){Y.log('Set attribute:'+name+', aborted; Attribute is writeOnce: "initOnly"','warn','attribute');allowSet=false;}
if(allowSet){if(!initialSet){currVal=this.get(name);}
if(path){val=O.setValue(Y.clone(currVal),path,val);if(val===undefined){Y.log('Set attribute path:'+strPath+', aborted; Path is invalid','warn','attribute');allowSet=false;}}
if(allowSet){if(!this._fireAttrChange||initializing){this._setAttrVal(name,strPath,currVal,val);}else{this._fireAttrChange(name,strPath,currVal,val,opts);}}}
return this;},_getAttr:function(name){var host=this,fullName=name,state=host._state,path,getter,val,cfg;if(name.indexOf(DOT)!==-1){path=name.split(DOT);name=path.shift();}
if(host._tCfgs&&host._tCfgs[name]){cfg={};cfg[name]=host._tCfgs[name];delete host._tCfgs[name];host._addAttrs(cfg,host._tVals);}
if(host._isLazyAttr(name)){host._addLazyAttr(name);}
val=host._getStateVal(name);getter=state.get(name,GETTER);if(getter&&!getter.call){getter=this[getter];}
val=(getter)?getter.call(host,val,fullName):val;val=(path)?O.getValue(val,path):val;return val;},_getStateVal:function(name){var stateProxy=this._stateProxy;return stateProxy&&(name in stateProxy)&&!this._state.get(name,BYPASS_PROXY)?stateProxy[name]:this._state.get(name,VALUE);},_setStateVal:function(name,value){var stateProxy=this._stateProxy;if(stateProxy&&(name in stateProxy)&&!this._state.get(name,BYPASS_PROXY)){stateProxy[name]=value;}else{this._state.add(name,VALUE,value);}},_setAttrVal:function(attrName,subAttrName,prevVal,newVal){var host=this,allowSet=true,cfg=this._state.getAll(attrName,true)||{},validator=cfg.validator,setter=cfg.setter,initializing=cfg.initializing,prevRawVal=this._getStateVal(attrName),name=subAttrName||attrName,retVal,valid;if(validator){if(!validator.call){validator=this[validator];}
if(validator){valid=validator.call(host,newVal,name);if(!valid&&initializing){newVal=cfg.defaultValue;valid=true;}}}
if(!validator||valid){if(setter){if(!setter.call){setter=this[setter];}
if(setter){retVal=setter.call(host,newVal,name);if(retVal===INVALID_VALUE){Y.log('Attribute: '+attrName+', setter returned Attribute.INVALID_VALUE for value:'+newVal,'warn','attribute');allowSet=false;}else if(retVal!==undefined){Y.log('Attribute: '+attrName+', raw value: '+newVal+' modified by setter to:'+retVal,'info','attribute');newVal=retVal;}}}
if(allowSet){if(!subAttrName&&(newVal===prevRawVal)&&!Lang.isObject(newVal)){Y.log('Attribute: '+attrName+', value unchanged:'+newVal,'warn','attribute');allowSet=false;}else{if(!(INIT_VALUE in cfg)){cfg.initValue=newVal;}
host._setStateVal(attrName,newVal);}}}else{Y.log('Attribute:'+attrName+', Validation failed for value:'+newVal,'warn','attribute');allowSet=false;}
return allowSet;},setAttrs:function(attrs){return this._setAttrs(attrs);},_setAttrs:function(attrs){for(var attr in attrs){if(attrs.hasOwnProperty(attr)){this.set(attr,attrs[attr]);}}
return this;},getAttrs:function(attrs){return this._getAttrs(attrs);},_getAttrs:function(attrs){var host=this,o={},i,l,attr,val,modifiedOnly=(attrs===true);attrs=(attrs&&!modifiedOnly)?attrs:O.keys(host._state.data);for(i=0,l=attrs.length;i<l;i++){attr=attrs[i];val=host.get(attr);if(!modifiedOnly||host._getStateVal(attr)!=host._state.get(attr,INIT_VALUE)){o[attr]=host.get(attr);}}
return o;},addAttrs:function(cfgs,values,lazy){var host=this;if(cfgs){host._tCfgs=cfgs;host._tVals=host._normAttrVals(values);host._addAttrs(cfgs,host._tVals,lazy);host._tCfgs=host._tVals=null;}
return host;},_addAttrs:function(cfgs,values,lazy){var host=this,attr,attrCfg,value;for(attr in cfgs){if(cfgs.hasOwnProperty(attr)){attrCfg=cfgs[attr];attrCfg.defaultValue=attrCfg.value;value=host._getAttrInitVal(attr,attrCfg,host._tVals);if(value!==undefined){attrCfg.value=value;}
if(host._tCfgs[attr]){delete host._tCfgs[attr];}
host.addAttr(attr,attrCfg,lazy);}}},_protectAttrs:function(attrs){if(attrs){attrs=Y.merge(attrs);for(var attr in attrs){if(attrs.hasOwnProperty(attr)){attrs[attr]=Y.merge(attrs[attr]);}}}
return attrs;},_normAttrVals:function(valueHash){return(valueHash)?Y.merge(valueHash):null;},_getAttrInitVal:function(attr,cfg,initValues){var val,valFn;if(!cfg.readOnly&&initValues&&initValues.hasOwnProperty(attr)){val=initValues[attr];}else{val=cfg.value;valFn=cfg.valueFn;if(valFn){if(!valFn.call){valFn=this[valFn];}
if(valFn){val=valFn.call(this,attr);}}}
Y.log('initValue for '+attr+':'+val,'info','attribute');return val;},_initAttrs:function(attrs,values,lazy){attrs=attrs||this.constructor.ATTRS;var Base=Y.Base,BaseCore=Y.BaseCore,baseInst=(Base&&Y.instanceOf(this,Base)),baseCoreInst=(!baseInst&&BaseCore&&Y.instanceOf(this,BaseCore));if(attrs&&!baseInst&&!baseCoreInst){this.addAttrs(this._protectAttrs(attrs),values,lazy);}}};Y.AttributeCore=AttributeCore;},'3.6.0');